---
layout: post
title: Web Application
---

## ยง1. Main Page

We will start by showing how to create the overall flask web application and specifically the main page.  We start by creating the main code document, app.py, which will house our functions and all of the Python code we will use.  Below is the code used to create the project and the main page.  Here is a link to the GitHub repository:  https://github.com/NicholasDelianedis/HW5App

```python
from flask import Flask, render_template, request, g
from flask import redirect, url_for, abort
import sqlite3
import os # import necessary items

app = Flask(__name__) # create flask
gidcount = 0 # create global id count for later

@app.route("/") # create main page
def main():
    return render_template('main.html') # render main template
```

So we start by importing all of the modules that we will need, including Flask, then create the app with Flask, and then define a function for the overall site where we render the template 'main.html'.  Now we will look at that template.

![Blog-5-main-html.png]({{ site.baseurl }}/images/Blog-5-main-html.png)

The first line in this template refers to 'base.html', which, as we will see in a moment, sets up the navigation section on each page.  Then, we have our title in the block header, and the content in the block content, which in this case is just a welcome statement.  Now we will look at 'base.html'

![Blog-5-base.png]({{ site.baseurl }}/images/Blog-5-base.png)

In this template, we have a statement stating the document type, html, then a head section which refers the application to the style sheet in the static folder, which we will come back to near the end of this blog post, and then the code for the navigation section, under the nav tag.  It contains the title, and links to the three main pages.  It also contains a section for the content of the page, which is filled in by the other templates for each page.

The main page, as constructed here, is shown below:

![Blog-5-Main.png]({{ site.baseurl }}/images/Blog-5-Main.png)

## ยง2. Submit Page

Next, we will show the submit page.  This page will accept submissions from users of their preferred handle, and a message from them.  Here is the code that implements this page from app.py:

```python
@app.route('/submit/', methods=['POST', 'GET']) # route to submit page
def submit():
    if request.method == 'GET': # if user wants to retrieve page
        return render_template('submit.html') # render template
    else: # if user wants to submit a message
        try:
            insert_message(request) # try adding info to database and return database successfully

            return render_template('submit.html', thanks=True)
        except: # otherwise give an error message
            return render_template('submit.html', error=True)
```

This function routes the user to the submit page, and then renders the template based on the user's intent, with it rendering 'submit.html' each time, but giving different inputs also if the user successfully submits information, where the template will thank the user, and where it will give the user an error message if something goes wrong.  It also tries to run the insert_message function, which will be explained below.

```python
def insert_message(request):
    conn = get_message_db() # connect to database
    handle = request.form["name"] # 
    message = request.form["message"]
    global gidcount
    gidcount += 1
    newid = gidcount
    cmd = \
    '''
    INSERT INTO `messages`
    VALUES (?, ?, ?);
    '''
    cursor = conn.cursor()
    cursor.execute(cmd, (newid, handle, message))
    conn.commit()
    conn.close()
```